# 蜂鸣器命令下发功能测试文档

## 功能概述

山体滑坡监测系统现已支持通过华为云IoT平台远程控制蜂鸣器，功能参考马达控制实现，支持多种蜂鸣模式和参数控制。

## 命令格式

### 基本命令结构
```json
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true/false,
    "frequency": 2000,
    "duration": 5,
    "pattern": 0
  }
}
```

### 参数说明

| 参数 | 类型 | 必需 | 默认值 | 说明 |
|------|------|------|--------|------|
| enable | boolean | 是 | - | 是否启用蜂鸣器 |
| frequency | integer | 否 | 2000 | 蜂鸣器频率 (100-10000 Hz) |
| duration | integer | 否 | 0 | 持续时间 (秒，0=持续运行) |
| pattern | integer | 否 | 0 | 蜂鸣模式 (0-3) |

### 蜂鸣模式说明

- **模式 0 (连续响)**: 根据duration参数连续响铃
- **模式 1 (短响)**: 200ms短响一次
- **模式 2 (长响)**: 1000ms长响一次  
- **模式 3 (间歇)**: 3次短响，间隔300ms

## 测试命令示例

### 1. 基本开启/关闭
```json
// 开启蜂鸣器 (默认2000Hz连续响)
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true
  }
}

// 关闭蜂鸣器
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": false
  }
}
```

### 2. 自定义频率测试
```json
// 高频蜂鸣 (5000Hz)
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 5000,
    "duration": 3,
    "pattern": 0
  }
}

// 低频蜂鸣 (500Hz)
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 500,
    "duration": 2,
    "pattern": 0
  }
}
```

### 3. 不同模式测试
```json
// 短响模式
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 3000,
    "pattern": 1
  }
}

// 长响模式
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 2500,
    "pattern": 2
  }
}

// 间歇模式
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 4000,
    "pattern": 3
  }
}
```

### 4. 定时蜂鸣测试
```json
// 连续响5秒后自动停止
{
  "service_id": "landslide_monitor",
  "command_name": "control_buzzer",
  "paras": {
    "enable": true,
    "frequency": 2000,
    "duration": 5,
    "pattern": 0
  }
}
```

## 调试信息

系统会输出详细的调试信息，包括：

1. **命令接收确认**
```
=== BUZZER CONTROL COMMAND ===
Buzzer parameters: enable=true, frequency=2000Hz, duration=5s, pattern=0
*** STARTING BUZZER *** (Start command #1)
```

2. **蜂鸣器状态变化**
```
Handling buzzer command: ENABLE
Frequency: 2000Hz, Duration: 5s, Pattern: CONTINUOUS
Buzzer activated
Buzzer continuous beep for 5 seconds
Buzzer beep: 5000ms at 2000Hz
```

3. **停止确认**
```
*** STOPPING BUZZER *** (Stop command #1)
Calling Buzzer_Off() directly...
Buzzer stopped
Buzzer_Off() called successfully
```

## 功能特点

1. **参数验证**: 自动限制频率范围 (100-10000 Hz)
2. **静音支持**: 当系统静音时自动忽略蜂鸣命令
3. **双重停止**: 停止命令会调用两次确保蜂鸣器完全关闭
4. **计数统计**: 记录启动/停止命令次数用于调试
5. **模式丰富**: 支持4种不同的蜂鸣模式
6. **频率可调**: 支持100Hz到10kHz的频率范围

## 测试步骤

1. 确保设备已连接到华为云IoT平台
2. 在华为云控制台发送上述测试命令
3. 观察设备串口输出的调试信息
4. 验证蜂鸣器是否按预期工作
5. 测试不同参数组合的效果

## 注意事项

- 频率超出范围会自动调整到有效范围
- duration=0时蜂鸣器会持续响直到收到停止命令
- 系统静音时所有蜂鸣命令都会被忽略
- 建议测试时使用较短的duration避免长时间噪音

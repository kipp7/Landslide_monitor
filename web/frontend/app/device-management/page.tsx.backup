'use client';

import React, { useState, useEffect, useCallback, useMemo } from 'react';
import {
  Card,
  Button,
  Modal,
  Form,
  Input,
  message,
  Tag,
  Space,
  Row,
  Col,
  Descriptions,
  Badge,
  Tooltip,
  Typography,
  Progress,
  Spin
} from 'antd';
import {
  EditOutlined,
  ReloadOutlined,
  InfoCircleOutlined,
  CheckCircleOutlined,
  ExclamationCircleOutlined,
  ClockCircleOutlined,
  DesktopOutlined,
  WifiOutlined,
  DisconnectOutlined,
  EnvironmentOutlined,
  ThunderboltOutlined,
  EyeOutlined,
  SettingOutlined
} from '@ant-design/icons';
import HoverSidebar from '../components/HoverSidebar';
import dynamic from 'next/dynamic';
import { useRouter } from 'next/navigation';

// 使用大屏的地图组件
const MapContainer = dynamic(() => import('../../app/components/MapContainer'), {
  ssr: false,
  loading: () => (
    <div className="w-full h-full bg-slate-700/30 rounded-lg flex items-center justify-center">
      <div className="text-slate-400 text-sm">加载地图中...</div>
    </div>
  )
});

const { Title, Text } = Typography;

interface DeviceInfo {
  device_id: string;
  real_name: string;
  display_name: string;
  status: 'online' | 'offline' | 'maintenance';
  last_active: string;
  location: string;
  coordinates: { lat: number; lng: number };
  device_type: string;
  firmware_version: string;
  install_date: string;
  data_count_today: number;
  last_data_time: string;
  health_score: number;
  temperature: number;
  humidity: number;
  battery_level: number;
  signal_strength: number;
}

export default function DeviceManagementPage() {
  const router = useRouter();
  const [editModalVisible, setEditModalVisible] = useState(false);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [currentDevice, setCurrentDevice] = useState<DeviceInfo | null>(null);
  const [loading, setLoading] = useState(false);
  const [realTimeData, setRealTimeData] = useState<any>(null);
  const [form] = Form.useForm();

  // 真实设备数据 - 基于实际的device_1
  const [deviceInfo, setDeviceInfo] = useState<DeviceInfo>({
    device_id: 'device_1',
    real_name: '6815a14f9314d118511807c6_rk2206',
    display_name: '龙门滑坡监测站',
    status: 'offline', // 默认离线，等API返回真实状态
    last_active: new Date().toISOString(),
    location: '防城港华石镇龙门村',
    coordinates: { lat: 21.6847, lng: 108.3516 },
    device_type: '软通套件',
    firmware_version: 'v2.1.3',
    install_date: '2025-06-01',
    data_count_today: 0,
    last_data_time: new Date().toISOString(),
    health_score: 0,
    temperature: 0,
    humidity: 0,
    battery_level: 0,
    signal_strength: 0
  });

  // GPS形变分析数据状态
  const [deformationData, setDeformationData] = useState({
    deformation_distance_3d: 0.125,
    deformation_horizontal: 0.089,
    deformation_vertical: -0.036,
    deformation_velocity: 0.0023,
    deformation_risk_level: 1,
    deformation_type: 3, // 复合形变
    deformation_confidence: 0.87,
    baseline_established: true
  });

  // 计算设备健康度算法
  const calculateHealthScore = (data: any) => {
    if (!data || !data.success) return 0;

    let score = 100;
    const now = new Date();
    const lastDataTime = new Date(data.data?.event_time || 0);
    const minutesSinceLastData = (now.getTime() - lastDataTime.getTime()) / (1000 * 60);

    // 根据数据新鲜度扣分
    if (minutesSinceLastData > 60) score -= 50; // 超过1小时扣50分
    else if (minutesSinceLastData > 30) score -= 30; // 超过30分钟扣30分
    else if (minutesSinceLastData > 10) score -= 15; // 超过10分钟扣15分

    // 根据数据完整性扣分
    const requiredFields = ['temperature', 'humidity', 'acceleration_x', 'acceleration_y', 'acceleration_z'];
    const missingFields = requiredFields.filter(field => !data.data?.[field]);
    score -= missingFields.length * 10;

    return Math.max(0, Math.min(100, score));
  };

  // 计算信号强度算法
  const calculateSignalStrength = (data: any) => {
    if (!data || !data.success) return 0;

    const now = new Date();
    const lastDataTime = new Date(data.data?.event_time || 0);
    const minutesSinceLastData = (now.getTime() - lastDataTime.getTime()) / (1000 * 60);

    // 基于数据传输延迟计算信号强度
    if (minutesSinceLastData <= 2) return 95; // 2分钟内：优秀
    if (minutesSinceLastData <= 5) return 80; // 5分钟内：良好
    if (minutesSinceLastData <= 10) return 60; // 10分钟内：一般
    if (minutesSinceLastData <= 30) return 30; // 30分钟内：较差
    return 10; // 超过30分钟：很差
  };

  // 计算电池电量算法（基于设备运行时间和数据频率）
  const calculateBatteryLevel = (installDate: string, dataCount: number) => {
    const now = new Date();
    const install = new Date(installDate);
    const daysSinceInstall = (now.getTime() - install.getTime()) / (1000 * 60 * 60 * 24);

    // 假设电池满电可用90天，每天理想数据量1440条（每分钟一条）
    const expectedDailyData = 1440;
    const batteryLifeDays = 90;

    // 基于运行天数计算基础电量
    let batteryLevel = Math.max(0, 100 - (daysSinceInstall / batteryLifeDays) * 100);

    // 基于数据传输频率调整（频率越高，耗电越快）
    const dataRatio = dataCount / expectedDailyData;
    if (dataRatio > 1.2) batteryLevel *= 0.9; // 数据量过高，额外耗电
    else if (dataRatio < 0.8) batteryLevel *= 1.05; // 数据量较低，省电

    return Math.max(0, Math.min(100, Math.round(batteryLevel)));
  };

  // 获取实时数据 - 直接从Supabase获取最新数据 (优化性能)
  const fetchRealTimeData = useCallback(async () => {
    try {
      setLoading(true);

      const response = await fetch(`/api/device-management?device_id=device_1`);
      const result = await response.json();

      console.log('API响应:', result);

      if (result.success) {
        console.log('更新设备信息:', result.data);
        setDeviceInfo(result.data);
        message.success('数据刷新成功');
      } else {
        throw new Error(result.error || '获取设备信息失败');
      }
    } catch (error) {
      console.error('获取设备信息失败:', error);
      message.error('数据刷新失败');
    } finally {
      setLoading(false);
    }
  }, []);



  // 页面初始化和定时刷新
  useEffect(() => {
    fetchRealTimeData();

    // 每30秒刷新一次数据
    const interval = setInterval(() => {
      fetchRealTimeData();
    }, 30000);

    return () => clearInterval(interval);
  }, [fetchRealTimeData]);

  // 数据导出处理
  const handleExportData = useCallback(async (exportType: 'today' | 'history') => {
    try {
      setLoading(true);

      const response = await fetch('/api/device-management/export', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          device_id: deviceInfo.device_id,
          export_type: exportType,
          format: 'csv'
        }),
      });

      if (response.ok) {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `device_${deviceInfo.device_id}_${exportType}_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        message.success('数据导出成功');
      } else {
        throw new Error('导出失败');
      }
    } catch (error) {
      console.error('数据导出失败:', error);
      message.error('数据导出失败');
    } finally {
      setLoading(false);
    }
  }, [deviceInfo.device_id]);

  // 生成报告处理
  const handleGenerateReport = useCallback(async (reportType: 'daily' | 'weekly' | 'monthly') => {
    try {
      setLoading(true);

      const response = await fetch('/api/device-management/reports', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          device_id: deviceInfo.device_id,
          report_type: reportType
        }),
      });

      const result = await response.json();

      if (result.success) {
        const report = result.data;

        // 显示报告摘要
        const reportSummary = `
📊 ${reportType === 'daily' ? '日' : reportType === 'weekly' ? '周' : '月'}报告生成完成

📈 数据概览：
• 数据完整性：${report.data_summary.data_completeness}%
• 总记录数：${report.data_summary.total_records}条
• 设备状态：${report.device_status.overall === 'healthy' ? '健康' : report.device_status.overall === 'warning' ? '警告' : '异常'}

${report.ai_analysis ? `
🤖 AI分析：
${report.ai_analysis.summary}

💡 关键洞察：
${report.ai_analysis.insights.map((insight: string) => `• ${insight}`).join('\n')}

🔧 AI建议：
${report.ai_analysis.recommendations.map((rec: string) => `• ${rec}`).join('\n')}
` : ''}

📋 详细报告已生成，包含完整的数据分析和维护建议。
        `;

        Modal.info({
          title: '📊 设备运行报告',
          content: (
            <div className="bg-slate-800 text-white p-4 rounded-lg">
              <pre className="whitespace-pre-wrap text-sm">{reportSummary}</pre>
            </div>
          ),
          width: 600,
          className: 'dark-modal',
          okText: '确定',
          okButtonProps: {
            className: 'bg-cyan-500 hover:bg-cyan-600 border-cyan-500'
          }
        });

        message.success('报告生成成功');
        console.log('完整报告数据:', report);
      } else {
        throw new Error(result.error || '生成报告失败');
      }
    } catch (error) {
      console.error('生成报告失败:', error);
      message.error('生成报告失败');
    } finally {
      setLoading(false);
    }
  }, [deviceInfo.device_id]);

  // 设备诊断处理
  const handleDeviceDiagnostics = useCallback(async () => {
    try {
      setLoading(true);

      const response = await fetch('/api/device-management/diagnostics', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          device_id: deviceInfo.device_id
        }),
      });

      const result = await response.json();

      if (result.success) {
        console.log('设备诊断完成:', result.data);
        message.success(`设备诊断完成 - 总体状态: ${result.data.overall_status}`);

        // 这里可以显示诊断结果的详细信息
        // 可以在这里打开一个新的模态框显示诊断结果
      } else {
        throw new Error(result.error || '设备诊断失败');
      }
    } catch (error) {
      console.error('设备诊断失败:', error);
      message.error('设备诊断失败');
    } finally {
      setLoading(false);
    }
  }, [deviceInfo.device_id]);

  // 设备健康度计算 (优化性能)
  const getHealthColor = useMemo(() => (score: number) => {
    if (score >= 90) return '#00ff88';
    if (score >= 70) return '#ffaa00';
    return '#ff4444';
  }, []);

  // 信号强度计算
  const getSignalColor = (strength: number) => {
    if (strength >= 80) return '#00ff88';
    if (strength >= 60) return '#ffaa00';
    return '#ff4444';
  };

  // 保存设备信息 - 使用新的API
  const handleSave = useCallback(async (values: any) => {
    try {
      setLoading(true);

      const response = await fetch('/api/device-management', {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          device_id: deviceInfo.device_id,
          ...values
        }),
      });

      const result = await response.json();

      if (result.success) {
        setDeviceInfo(prev => ({ ...prev, ...values }));
        message.success('设备信息更新成功');
        setEditModalVisible(false);
      } else {
        throw new Error(result.error || '更新失败');
      }
    } catch (error) {
      console.error('保存设备信息失败:', error);
      message.error('保存失败');
    } finally {
      setLoading(false);
    }
  }, [deviceInfo.device_id]);



  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {/* 悬浮侧边菜单 */}
      <HoverSidebar />

      {/* 顶部导航 - 大屏同色系 */}
      <div className="bg-gradient-to-r from-slate-900 via-blue-900 to-slate-900 text-white shadow-lg">
        <div className="px-6 py-4">
          <div className="flex justify-between items-center">
            {/* 左侧 - 系统名称和导航 */}
            <div className="flex items-center space-x-8">
              <div>
                <div className="text-lg font-semibold text-cyan-100">滑坡监测系统</div>
                <div className="text-xs text-slate-300">Landslide Monitoring System</div>
              </div>

              <nav className="hidden md:flex space-x-1">
                <a
                  href="/"
                  className="text-slate-300 hover:text-cyan-200 px-4 py-2 text-sm rounded-md hover:bg-slate-700/50 transition-all"
                >
                  实时监控
                </a>
                <a
                  href="/analysis"
                  className="text-slate-300 hover:text-cyan-200 px-4 py-2 text-sm rounded-md hover:bg-slate-700/50 transition-all"
                >
                  数据分析
                </a>
                <a
                  href="/device-management"
                  className="text-cyan-200 bg-slate-700/70 px-4 py-2 text-sm rounded-md font-medium border border-cyan-400/30"
                >
                  设备管理
                </a>
                <a
                  href="/settings"
                  className="text-slate-300 hover:text-cyan-200 px-4 py-2 text-sm rounded-md hover:bg-slate-700/50 transition-all"
                >
                  系统配置
                </a>
              </nav>
            </div>

            {/* 右侧 - 状态信息 */}
            <div className="flex items-center space-x-6">
              <div className="flex items-center space-x-2 bg-slate-700/50 px-3 py-1 rounded-full">
                <div className={`w-2 h-2 rounded-full ${deviceInfo.status === 'online' ? 'bg-green-400 animate-pulse' : 'bg-red-400'}`}></div>
                <span className="text-sm text-slate-200">
                  {deviceInfo.status === 'online' ? '设备在线' : '设备离线'}
                </span>
              </div>

              <div className="text-sm text-slate-300 font-mono">
                {new Date().toLocaleString('zh-CN')}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div className="px-4 sm:px-6 lg:px-8 py-8">
        {/* 页面标题区域 */}
        <div className="bg-slate-800/80 backdrop-blur-sm border-l-4 border-cyan-400 shadow-lg mb-6">
          <div className="px-6 py-5">
            <div className="flex justify-between items-start">
              <div>
                <h1 className="text-xl font-bold text-white flex items-center space-x-2">
                  <span>{deviceInfo.display_name}</span>
                  <span className={`px-2 py-1 text-xs rounded-full ${deviceInfo.status === 'online' ? 'bg-green-500/20 text-green-300 border border-green-400' : 'bg-red-500/20 text-red-300 border border-red-400'}`}>
                    {deviceInfo.status === 'online' ? '运行中' : '离线'}
                  </span>
                </h1>
                <div className="mt-1 flex items-center space-x-4 text-sm text-slate-300">
                  <span>位置: {deviceInfo.location}</span>
                  <span>类型: {deviceInfo.device_type}</span>
                  <span>版本: {deviceInfo.firmware_version}</span>
                </div>
              </div>
              <div className="flex space-x-3">
                <button
                  onClick={fetchRealTimeData}
                  disabled={loading}
                  className="px-4 py-2 bg-slate-700 text-slate-200 text-sm border border-slate-600 rounded-lg hover:bg-slate-600 disabled:opacity-50 transition-colors"
                >
                  {loading ? '刷新中...' : '刷新数据'}
                </button>
                <button
                  onClick={() => setDetailModalVisible(true)}
                  className="px-4 py-2 bg-cyan-500 text-white text-sm rounded-lg hover:bg-cyan-600 transition-colors shadow-md"
                >
                  详细信息
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* 主要内容区域 - 7列布局，增加垂直高度 */}
        <div className="grid grid-cols-1 lg:grid-cols-7 gap-4 mb-6 h-[calc(100vh-280px)]">
          {/* 左侧环境数据与设备状态面板 */}
          <div className="lg:col-span-1">
            <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
              <div className="px-4 py-3 bg-slate-700/50 border-b border-slate-600">
                <h3 className="text-sm font-semibold text-cyan-300">
                  <span>�</span>
                  <span>环境与状态</span>
                </h3>
              </div>
              <div className="p-4 space-y-4 overflow-y-auto">
                {/* 环境数据区域 */}
                <div className="space-y-3">
                  <div className="text-xs text-slate-400 font-medium mb-2">环境数据</div>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between p-2 bg-orange-500/10 border border-orange-400/30 rounded-lg">
                      <div className="flex items-center space-x-2">

                        <span className="text-xs text-slate-300">温度</span>
                      </div>
                      <div className="text-sm font-bold text-orange-300">{deviceInfo.temperature}°C</div>
                    </div>
                    <div className="flex items-center justify-between p-2 bg-blue-500/10 border border-blue-400/30 rounded-lg">
                      <div className="flex items-center space-x-2">

                        <span className="text-xs text-slate-300">湿度</span>
                      </div>
                      <div className="text-sm font-bold text-blue-300">{deviceInfo.humidity}%</div>
                    </div>
                  </div>
                </div>

                {/* 分隔线 */}
                <div className="border-t border-slate-600"></div>

                {/* 设备状态区域 */}
                <div className="space-y-3">
                  <div className="text-xs text-slate-400 font-medium mb-2">设备状态</div>

                  {/* 健康度 */}
                  <div className="space-y-1">
                    <div className="flex justify-between items-center">
                      <span className="text-xs text-slate-400">健康度</span>
                      <span className="text-sm font-bold text-green-300">{deviceInfo.health_score}%</span>
                    </div>
                    <div className="w-full bg-slate-600 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full transition-all duration-300 ${
                          deviceInfo.health_score > 70 ? 'bg-green-400' :
                          deviceInfo.health_score > 40 ? 'bg-yellow-400' : 'bg-red-400'
                        }`}
                        style={{ width: `${deviceInfo.health_score}%` }}
                      ></div>
                    </div>
                  </div>

                  {/* 电池电量 */}
                  <div className="space-y-1">
                    <div className="flex justify-between items-center">
                      <span className="text-xs text-slate-400">电池电量</span>
                      <span className="text-sm font-bold text-blue-300">{deviceInfo.battery_level}%</span>
                    </div>
                    <div className="w-full bg-slate-600 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full transition-all duration-300 ${
                          deviceInfo.battery_level > 50 ? 'bg-blue-400' :
                          deviceInfo.battery_level > 20 ? 'bg-yellow-400' : 'bg-red-400'
                        }`}
                        style={{ width: `${deviceInfo.battery_level}%` }}
                      ></div>
                    </div>
                  </div>

                  {/* 信号强度 */}
                  <div className="space-y-1">
                    <div className="flex justify-between items-center">
                      <span className="text-xs text-slate-400">信号强度</span>
                      <span className="text-sm font-bold text-cyan-300">{deviceInfo.signal_strength}%</span>
                    </div>
                    <div className="w-full bg-slate-600 rounded-full h-2">
                      <div
                        className={`h-2 rounded-full transition-all duration-300 ${
                          deviceInfo.signal_strength > 70 ? 'bg-cyan-400' :
                          deviceInfo.signal_strength > 40 ? 'bg-yellow-400' : 'bg-red-400'
                        }`}
                        style={{ width: `${deviceInfo.signal_strength}%` }}
                      ></div>
                    </div>
                  </div>
                </div>

                {/* 分隔线 */}
                <div className="border-t border-slate-600"></div>

                {/* 状态摘要 */}
                <div className="space-y-2">
                  <div className="text-xs text-slate-400 font-medium">状态摘要</div>
                  <div className="bg-slate-700/30 rounded-lg p-2">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-slate-400">设备状态</span>
                      <span className={`font-medium ${
                        deviceInfo.status === 'online' ? 'text-green-400' : 'text-red-400'
                      }`}>
                        {deviceInfo.status === 'online' ? '在线' : '离线'}
                      </span>
                    </div>
                    <div className="flex items-center justify-between text-xs mt-1">
                      <span className="text-slate-400">最后更新</span>
                      <span className="text-white">
                        {new Date(deviceInfo.last_data_time).toLocaleTimeString('zh-CN')}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* 中间设备信息与控制面板 */}
          <div className="lg:col-span-1">
            <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
              <div className="px-4 py-3 bg-slate-700/50 border-b border-slate-600">
                <h3 className="text-sm font-semibold text-cyan-300">设备信息与控制</h3>
              </div>
              <div className="p-4">
                <div className="space-y-4">
                  {/* 基本信息 */}
                  <div className="space-y-3">
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">设备名称</span>
                      <span className="text-sm font-medium text-white">{deviceInfo.display_name}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">设备编号</span>
                      <span className="text-xs font-mono text-cyan-300 bg-slate-700 px-2 py-1 rounded">{deviceInfo.device_id}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">设备类型</span>
                      <span className="text-sm text-white">{deviceInfo.device_type}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">固件版本</span>
                      <span className="text-sm text-white">{deviceInfo.firmware_version}</span>
                    </div>
                    <div className="flex justify-between items-center">
                      <span className="text-sm text-slate-400">安装位置</span>
                      <span className="text-sm text-white">{deviceInfo.location}</span>
                    </div>
                  </div>

                  {/* 运行状态 */}
                  <div className="pt-3 border-t border-slate-600">
                    <div className="flex justify-between items-center mb-3">
                      <span className="text-sm text-slate-400">运行状态</span>
                      <span className={`text-sm font-semibold px-2 py-1 rounded-full ${deviceInfo.status === 'online' ? 'bg-green-500/20 text-green-300 border border-green-400' : 'bg-red-500/20 text-red-300 border border-red-400'}`}>
                        {deviceInfo.status === 'online' ? '正常运行' : '设备离线'}
                      </span>
                    </div>
                    <div className="text-xs text-slate-400 mb-2">
                      运行时间: {Math.floor((Date.now() - new Date(deviceInfo.install_date).getTime()) / (1000 * 60 * 60 * 24))} 天
                    </div>
                  </div>

                  {/* 快速操作 */}
                  <div className="pt-3 border-t border-slate-600">
                    <div className="text-sm text-slate-400 mb-3">快速操作</div>
                    <div className="space-y-2">
                      <button
                        onClick={fetchRealTimeData}
                        disabled={loading}
                        className="w-full px-3 py-2 text-xs bg-cyan-500/20 text-cyan-300 border border-cyan-400 rounded hover:bg-cyan-500/30 disabled:opacity-50 transition-colors"
                      >
                        {loading ? '刷新中...' : '刷新数据'}
                      </button>
                      <button
                        onClick={() => setDetailModalVisible(true)}
                        className="w-full px-3 py-2 text-xs bg-blue-500/20 text-blue-300 border border-blue-400 rounded hover:bg-blue-500/30 transition-colors"
                      >
                        详细报告
                      </button>
                      <button
                        onClick={() => setEditModalVisible(true)}
                        className="w-full px-3 py-2 text-xs bg-slate-600 text-slate-300 border border-slate-500 rounded hover:bg-slate-500 transition-colors"
                      >
                        设备配置
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* 中间真实地图区域 - 保持3列 */}
          <div className="lg:col-span-3">
            <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full flex flex-col">
              <div className="px-4 py-3 bg-slate-700/50 border-b border-slate-600">
                <div className="flex justify-between items-center">
                  <h3 className="text-sm font-semibold text-cyan-300">设备位置地图</h3>
                  <div className="flex items-center space-x-2 text-xs text-slate-400">
                    <span>实时定位</span>
                    <div className={`w-2 h-2 rounded-full ${deviceInfo.status === 'online' ? 'bg-green-400 animate-pulse' : 'bg-red-400'}`}></div>
                  </div>
                </div>
              </div>
              <div className="flex-1 p-4 flex flex-col">
                {/* 地图区域 - 占据全部可用空间 */}
                <div className="flex-1 rounded-lg overflow-hidden">
                  {(() => {
                    const mapProps = {
                      mode: "2D" as const,
                      devices: [{
                        device_id: deviceInfo.device_id,
                        name: deviceInfo.display_name,
                        coord: [deviceInfo.coordinates.lng, deviceInfo.coordinates.lat] as [number, number],
                        temp: parseFloat(deviceInfo.temperature.toString()),
                        hum: parseFloat(deviceInfo.humidity.toString()),
                        status: deviceInfo.status
                      }],
                      center: [deviceInfo.coordinates.lng, deviceInfo.coordinates.lat] as [number, number],
                      zoom: 15
                    };

                    console.log('传递给地图的数据:', {
                      deviceInfo: {
                        device_id: deviceInfo.device_id,
                        display_name: deviceInfo.display_name,
                        coordinates: deviceInfo.coordinates,
                        status: deviceInfo.status
                      },
                      mapProps
                    });

                    return <MapContainer {...mapProps} />;
                  })()}
                </div>
              </div>
            </div>
          </div>

          {/* 右侧GPS形变分析面板 */}
          <div className="lg:col-span-1">
            <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
              <div className="px-4 py-3 bg-slate-700/50 border-b border-slate-600">
                <h3 className="text-sm font-semibold text-cyan-300">
                  <span>�</span>
                  <span>GPS形变分析</span>
                </h3>
              </div>
              <div className="p-4 space-y-4 overflow-y-auto">
                {/* 3D总位移距离 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">3D总位移</span>
                    <span className="text-xs text-cyan-300">m</span>
                  </div>
                  <div className="text-lg font-bold text-white">
                    {deformationData.deformation_distance_3d.toFixed(3)}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    相对基准点位移
                  </div>
                </div>

                {/* 水平位移距离 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">水平位移</span>
                    <span className="text-xs text-cyan-300">m</span>
                  </div>
                  <div className="text-lg font-bold text-white">
                    {deformationData.deformation_horizontal.toFixed(3)}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    水平方向位移
                  </div>
                </div>

                {/* 垂直位移距离 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">垂直位移</span>
                    <span className="text-xs text-cyan-300">m</span>
                  </div>
                  <div className="text-lg font-bold text-white">
                    {deformationData.deformation_vertical.toFixed(3)}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    垂直方向位移
                  </div>
                </div>

                {/* 形变速度 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">形变速度</span>
                    <span className="text-xs text-cyan-300">m/h</span>
                  </div>
                  <div className="text-lg font-bold text-white">
                    {deformationData.deformation_velocity.toFixed(4)}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    实时形变速度
                  </div>
                </div>

                {/* 形变风险等级 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">风险等级</span>
                    <span className="text-xs text-green-400">安全</span>
                  </div>
                  <div className="flex items-center space-x-1">
                    {[0, 1, 2, 3, 4].map(level => (
                      <div
                        key={level}
                        className={`w-3 h-3 rounded-full ${
                          level <= deformationData.deformation_risk_level
                            ? level <= 1 ? 'bg-green-400' : level <= 2 ? 'bg-yellow-400' : 'bg-red-400'
                            : 'bg-slate-600'
                        }`}
                      />
                    ))}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    当前风险等级: {deformationData.deformation_risk_level}
                  </div>
                </div>

                {/* 基准位置状态 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">基准状态</span>
                    <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                  </div>
                  <div className="text-sm font-medium text-green-400">
                    {deformationData.baseline_established ? '已建立基准' : '未建立基准'}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    置信度: {deformationData.deformation_confidence.toFixed(2)}
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* 右侧形变趋势分析面板 */}
          <div className="lg:col-span-1">
            <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
              <div className="px-4 py-3 bg-slate-700/50 border-b border-slate-600">
                <h3 className="text-sm font-semibold text-cyan-300">

                  形变趋势
                </h3>
              </div>
              <div className="p-4 space-y-4 overflow-y-auto">
                {/* 形变类型 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">形变类型</span>
                    <span className="text-xs text-blue-400">复合</span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <div className="w-3 h-3 bg-blue-400 rounded-full"></div>
                    <span className="text-sm text-white">水平+垂直</span>
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    检测到复合形变
                  </div>
                </div>

                {/* 分析置信度 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">置信度</span>
                    <span className="text-xs text-green-400">高</span>
                  </div>
                  <div className="w-full bg-slate-600 rounded-full h-2 mb-2">
                    <div
                      className="bg-green-400 h-2 rounded-full"
                      style={{ width: `${(deformationData.deformation_confidence * 100).toFixed(0)}%` }}
                    ></div>
                  </div>
                  <div className="text-sm font-medium text-white">
                    {(deformationData.deformation_confidence * 100).toFixed(0)}%
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    分析可信度
                  </div>
                </div>

                {/* 24小时趋势 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">24h趋势</span>
                    <span className="text-xs text-yellow-400">稳定</span>
                  </div>
                  <div className="flex items-center justify-between text-xs">
                    <span className="text-slate-400">最大位移</span>
                    <span className="text-white">{(deformationData.deformation_distance_3d * 1.2).toFixed(3)}m</span>
                  </div>
                  <div className="flex items-center justify-between text-xs mt-1">
                    <span className="text-slate-400">平均速度</span>
                    <span className="text-white">{(deformationData.deformation_velocity * 0.8).toFixed(4)}m/h</span>
                  </div>
                </div>

                {/* 预警状态 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">预警状态</span>
                    <div className={`w-2 h-2 rounded-full animate-pulse ${
                      deformationData.deformation_risk_level <= 1 ? 'bg-green-400' :
                      deformationData.deformation_risk_level <= 2 ? 'bg-yellow-400' : 'bg-red-400'
                    }`}></div>
                  </div>
                  <div className={`text-sm font-medium ${
                    deformationData.deformation_risk_level <= 1 ? 'text-green-400' :
                    deformationData.deformation_risk_level <= 2 ? 'text-yellow-400' : 'text-red-400'
                  }`}>
                    {deformationData.deformation_risk_level <= 1 ? '正常监测' :
                     deformationData.deformation_risk_level <= 2 ? '注意观察' : '预警状态'}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    {deformationData.deformation_risk_level <= 1 ? '未触发预警阈值' :
                     deformationData.deformation_risk_level <= 2 ? '接近预警阈值' : '已触发预警阈值'}
                  </div>
                </div>

                {/* 下次校准 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">下次校准</span>
                    <span className="text-xs text-cyan-400">7天后</span>
                  </div>
                  <div className="text-sm text-white">
                    {new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString('zh-CN')}
                  </div>
                  <div className="text-xs text-slate-400 mt-1">
                    基准点重新校准
                  </div>
                </div>

                {/* 历史对比 */}
                <div className="bg-slate-700/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-xs text-slate-400">历史对比</span>
                    <span className="text-xs text-cyan-400">本周</span>
                  </div>
                  <div className="space-y-1">
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-slate-400">位移变化</span>
                      <span className="text-green-300">+{(deformationData.deformation_distance_3d * 0.1).toFixed(3)}m</span>
                    </div>
                    <div className="flex items-center justify-between text-xs">
                      <span className="text-slate-400">速度变化</span>
                      <span className="text-blue-300">-{(deformationData.deformation_velocity * 0.2).toFixed(4)}m/h</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        {/* 扩展功能区域 */}
        <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
          {/* 数据统计 */}
          <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
            <div className="px-4 py-2 bg-slate-700/50 border-b border-slate-600">
              <h3 className="text-sm font-semibold text-cyan-300">数据统计</h3>
            </div>
            <div className="p-3">
              <div className="text-center mb-3">
                <div className="text-2xl font-bold text-cyan-300 mb-1">{deviceInfo.data_count_today}</div>
                <div className="text-sm text-slate-300 font-medium">今日采集数据</div>
                <div className="text-xs text-slate-500">Data Points Today</div>
              </div>
              <div className="space-y-2 text-sm">
                <div className="flex justify-between items-center">
                  <span className="text-slate-400">安装日期</span>
                  <span className="text-white font-medium">{deviceInfo.install_date}</span>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-slate-400">运行天数</span>
                  <span className="text-white font-medium">
                    {Math.floor((Date.now() - new Date(deviceInfo.install_date).getTime()) / (1000 * 60 * 60 * 24))} 天
                  </span>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-slate-400">采样频率</span>
                  <span className="text-white font-medium">1分钟/次</span>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-slate-400">总数据量</span>
                  <span className="text-cyan-300 font-medium">
                    {(deviceInfo.data_count_today * Math.floor((Date.now() - new Date(deviceInfo.install_date).getTime()) / (1000 * 60 * 60 * 24)) * 0.8).toLocaleString()}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* 地理位置信息 */}
          <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
            <div className="px-4 py-2 bg-slate-700/50 border-b border-slate-600">
              <h3 className="text-sm font-semibold text-cyan-300">地理位置信息</h3>
            </div>
            <div className="p-3">
              <div className="h-16 bg-slate-700/30 border border-slate-600 rounded-lg flex items-center justify-center relative overflow-hidden mb-3">
                {/* 地图网格背景 */}
                <div className="absolute inset-0 opacity-20">
                  {[...Array(8)].map((_, i) => (
                    <div key={i} className="absolute border-cyan-400/30" style={{
                      left: `${i * 12.5}%`,
                      top: 0,
                      bottom: 0,
                      borderLeft: '1px solid'
                    }} />
                  ))}
                  {[...Array(6)].map((_, i) => (
                    <div key={i} className="absolute border-cyan-400/30" style={{
                      top: `${i * 16.67}%`,
                      left: 0,
                      right: 0,
                      borderTop: '1px solid'
                    }} />
                  ))}
                </div>

                <div className="text-center relative z-10">
                  <EnvironmentOutlined className="text-xl text-red-400 mb-1" />
                  <div className="text-xs font-bold text-white">{deviceInfo.display_name}</div>
                </div>
              </div>

              <div className="space-y-2 text-sm">
                <div className="flex justify-between">
                  <span className="text-slate-400">安装位置</span>
                  <span className="text-white text-right">{deviceInfo.location}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-slate-400">经度坐标</span>
                  <span className="text-cyan-300 font-mono">{deviceInfo.coordinates.lng}°E</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-slate-400">纬度坐标</span>
                  <span className="text-cyan-300 font-mono">{deviceInfo.coordinates.lat}°N</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-slate-400">海拔高度</span>
                  <span className="text-white">约 125m</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-slate-400">地理区域</span>
                  <span className="text-white">华南地区</span>
                </div>
              </div>
            </div>
          </div>

          {/* 报警与通知 */}
          <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
            <div className="px-4 py-2 bg-slate-700/50 border-b border-slate-600">
              <h3 className="text-sm font-semibold text-cyan-300">报警与通知</h3>
            </div>
            <div className="p-3">
              <div className="space-y-2">
                <div className="flex items-center justify-between p-2 bg-green-500/10 border border-green-400/30 rounded">
                  <div className="flex items-center space-x-2">
                    <div className="w-2 h-2 bg-green-400 rounded-full"></div>
                    <span className="text-xs text-green-300">系统正常</span>
                  </div>
                  <span className="text-xs text-slate-400">刚刚</span>
                </div>

                <div className="flex items-center justify-between p-2 bg-yellow-500/10 border border-yellow-400/30 rounded">
                  <div className="flex items-center space-x-2">
                    <div className="w-2 h-2 bg-yellow-400 rounded-full"></div>
                    <span className="text-xs text-yellow-300">电量提醒</span>
                  </div>
                  <span className="text-xs text-slate-400">2小时前</span>
                </div>

                <div className="flex items-center justify-between p-2 bg-blue-500/10 border border-blue-400/30 rounded">
                  <div className="flex items-center space-x-2">
                    <div className="w-2 h-2 bg-blue-400 rounded-full"></div>
                    <span className="text-xs text-blue-300">数据同步</span>
                  </div>
                  <span className="text-xs text-slate-400">1天前</span>
                </div>
              </div>

              <div className="mt-3 pt-2 border-t border-slate-600">
                <button className="w-full px-3 py-2 text-xs bg-slate-700 text-slate-300 border border-slate-600 rounded hover:bg-slate-600 transition-colors">
                  查看所有通知
                </button>
              </div>
            </div>
          </div>

          {/* 数据导出与维护 */}
          <div className="bg-slate-800/80 backdrop-blur-sm border border-slate-600 rounded-lg shadow-lg overflow-hidden h-full">
            <div className="px-4 py-2 bg-slate-700/50 border-b border-slate-600">
              <h3 className="text-sm font-semibold text-cyan-300">数据导出与维护</h3>
            </div>
            <div className="p-3">
              <div className="space-y-2">
                <button
                  onClick={() => handleExportData('today')}
                  disabled={loading}
                  className="w-full px-3 py-2 text-xs bg-green-500/20 text-green-300 border border-green-400 rounded hover:bg-green-500/30 disabled:opacity-50 transition-colors"
                >
                  导出今日数据
                </button>

                <button
                  onClick={() => handleExportData('history')}
                  disabled={loading}
                  className="w-full px-3 py-2 text-xs bg-blue-500/20 text-blue-300 border border-blue-400 rounded hover:bg-blue-500/30 disabled:opacity-50 transition-colors"
                >
                  导出历史数据
                </button>

                <button
                  onClick={() => handleGenerateReport('daily')}
                  disabled={loading}
                  className="w-full px-3 py-2 text-xs bg-purple-500/20 text-purple-300 border border-purple-400 rounded hover:bg-purple-500/30 disabled:opacity-50 transition-colors"
                >
                  生成报告
                </button>

                <button
                  onClick={handleDeviceDiagnostics}
                  disabled={loading}
                  className="w-full px-3 py-2 text-xs bg-orange-500/20 text-orange-300 border border-orange-400 rounded hover:bg-orange-500/30 disabled:opacity-50 transition-colors"
                >
                  设备诊断
                </button>
              </div>

              <div className="mt-3 pt-2 border-t border-slate-600">
                <div className="bg-slate-700/30 p-2 rounded-lg">
                  <div className="text-xs text-slate-400 mb-2">维护信息</div>
                  <div className="space-y-1 text-xs">
                    <div className="flex justify-between">
                      <span className="text-slate-500">上次维护</span>
                      <span className="text-slate-300">2024-12-15</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-slate-500">下次维护</span>
                      <span className="text-yellow-300">2025-03-15</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* 设备详情模态框 - 深色风格 */}
        <Modal
          title={
            <div className="flex items-center space-x-2 text-cyan-300">
              <DesktopOutlined className="text-cyan-400" />
              <span>设备详细信息</span>
            </div>
          }
          open={detailModalVisible}
          onCancel={() => setDetailModalVisible(false)}
          footer={
            <div className="flex justify-end space-x-3 px-2">
              <Button
                key="close"
                onClick={() => setDetailModalVisible(false)}
                className="bg-slate-700 text-slate-300 border-slate-600 hover:bg-slate-600"
                size="middle"
              >
                关闭
              </Button>
              <Button
                key="edit"
                type="primary"
                onClick={() => {
                  setDetailModalVisible(false);
                  setEditModalVisible(true);
                }}
                className="bg-cyan-500 hover:bg-cyan-600 border-cyan-500"
                size="middle"
              >
                编辑设备
              </Button>
            </div>
          }
          width={800}
          className="dark-modal"
        >
          <div className="bg-slate-800 p-4 rounded-lg">
            <Descriptions bordered column={2} size="middle" className="dark-descriptions">
              <Descriptions.Item label="设备ID" span={1}>
                <Text code className="bg-slate-700 px-2 py-1 rounded text-cyan-300">{deviceInfo.device_id}</Text>
              </Descriptions.Item>
              <Descriptions.Item label="显示名称" span={1}>
                <Text strong className="text-white">{deviceInfo.display_name}</Text>
              </Descriptions.Item>
              <Descriptions.Item label="真实设备名称" span={2}>
                <Text code className="text-xs bg-slate-700 px-2 py-1 rounded text-slate-300">{deviceInfo.real_name}</Text>
              </Descriptions.Item>
              <Descriptions.Item label="设备类型" span={1}>
                <Tag color="blue" className="bg-blue-500/20 text-blue-300 border-blue-400">{deviceInfo.device_type}</Tag>
              </Descriptions.Item>
              <Descriptions.Item label="固件版本" span={1}>
                <Tag color="green" className="bg-green-500/20 text-green-300 border-green-400">{deviceInfo.firmware_version}</Tag>
              </Descriptions.Item>
              <Descriptions.Item label="安装位置" span={2}>
                <div className="flex items-center space-x-2">
                  <EnvironmentOutlined className="text-red-400" />
                  <span className="text-white">{deviceInfo.location}</span>
                </div>
              </Descriptions.Item>
              <Descriptions.Item label="坐标信息" span={2}>
                <span className="text-cyan-300 font-mono">
                  经度: {deviceInfo.coordinates.lng}° | 纬度: {deviceInfo.coordinates.lat}°
                </span>
              </Descriptions.Item>
              <Descriptions.Item label="安装日期" span={1}>
                <span className="text-white">{deviceInfo.install_date}</span>
              </Descriptions.Item>
              <Descriptions.Item label="设备状态" span={1}>
                <Badge
                  status={deviceInfo.status === 'online' ? 'success' : 'error'}
                  text={
                    <span className={`font-medium ${deviceInfo.status === 'online' ? 'text-green-400' : 'text-red-400'}`}>
                      {deviceInfo.status === 'online' ? '在线' : '离线'}
                    </span>
                  }
                />
              </Descriptions.Item>
              <Descriptions.Item label="健康度" span={1}>
                <div className="flex items-center space-x-3">
                  <div className="flex-1 max-w-24">
                    <div className="w-full bg-slate-700 rounded-full h-2 overflow-hidden">
                      <div
                        className="h-2 rounded-full transition-all duration-500"
                        style={{
                          width: `${deviceInfo.health_score}%`,
                          backgroundColor: getHealthColor(deviceInfo.health_score)
                        }}
                      ></div>
                    </div>
                  </div>
                  <span className="text-white font-medium">{deviceInfo.health_score}%</span>
                </div>
              </Descriptions.Item>
              <Descriptions.Item label="今日数据量" span={1}>
                <span className="text-cyan-300 font-bold">{deviceInfo.data_count_today} 条</span>
              </Descriptions.Item>
              <Descriptions.Item label="最新数据时间" span={2}>
                <span className="text-white">{new Date(deviceInfo.last_data_time).toLocaleString()}</span>
              </Descriptions.Item>
            </Descriptions>
          </div>
        </Modal>

        {/* 编辑设备模态框 - 深色风格 */}
        <Modal
          title={
            <div className="flex items-center space-x-2 text-cyan-300">
              <SettingOutlined className="text-cyan-400" />
              <span>设备配置</span>
            </div>
          }
          open={editModalVisible}
          onCancel={() => setEditModalVisible(false)}
          onOk={() => form.submit()}
          confirmLoading={loading}
          width={700}
          okText="保存"
          cancelText="取消"
          className="dark-modal"
          okButtonProps={{
            className: "bg-cyan-500 hover:bg-cyan-600 border-cyan-500"
          }}
          cancelButtonProps={{
            className: "bg-slate-700 text-slate-300 border-slate-600 hover:bg-slate-600"
          }}
        >
          <div className="bg-slate-800 p-4 rounded-lg">
            <Form
              form={form}
              layout="vertical"
              onFinish={handleSave}
              initialValues={deviceInfo}
              className="dark-form"
            >
              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label={<span className="text-slate-300">设备ID</span>}
                    name="device_id"
                  >
                    <Input disabled prefix={<DesktopOutlined />} className="bg-slate-700 text-cyan-300 border-slate-600" />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    label={<span className="text-slate-300">设备类型</span>}
                    name="device_type"
                  >
                    <Input placeholder="例如：软通套件" className="bg-slate-700 text-white border-slate-600 placeholder-slate-400" />
                  </Form.Item>
                </Col>
              </Row>

              <Form.Item
                label={<span className="text-slate-300">显示名称</span>}
                name="display_name"
                rules={[{ required: true, message: '请输入显示名称' }]}
              >
                <Input placeholder="例如：龙门滑坡监测站" className="bg-slate-700 text-white border-slate-600 placeholder-slate-400" />
              </Form.Item>

              <Form.Item
                label={<span className="text-slate-300">安装位置</span>}
                name="location"
                rules={[{ required: true, message: '请输入安装位置' }]}
              >
                <Input placeholder="例如：防城港华石镇龙门村" className="bg-slate-700 text-white border-slate-600 placeholder-slate-400" />
              </Form.Item>

              <Row gutter={16}>
                <Col span={12}>
                  <Form.Item
                    label={<span className="text-slate-300">固件版本</span>}
                    name="firmware_version"
                  >
                    <Input placeholder="例如：v2.1.3" className="bg-slate-700 text-white border-slate-600 placeholder-slate-400" />
                  </Form.Item>
                </Col>
                <Col span={12}>
                  <Form.Item
                    label={<span className="text-slate-300">安装日期</span>}
                    name="install_date"
                  >
                    <Input placeholder="例如：2025-06-01" className="bg-slate-700 text-white border-slate-600 placeholder-slate-400" />
                  </Form.Item>
                </Col>
              </Row>
            </Form>
          </div>
        </Modal>

        {/* 深色主题样式 */}
        <style jsx global>{`
        /* 深色模态框样式 - 更强的覆盖 */
        .ant-modal-mask {
          background: rgba(0, 0, 0, 0.8) !important;
        }

        .dark-modal .ant-modal-content,
        .ant-modal-content {
          background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
          border: 1px solid #475569 !important;
          border-radius: 12px !important;
          box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8) !important;
        }

        .dark-modal .ant-modal-header,
        .ant-modal-header {
          background: rgba(30, 41, 59, 0.9) !important;
          border-bottom: 1px solid #475569 !important;
          border-radius: 12px 12px 0 0 !important;
        }

        .dark-modal .ant-modal-title,
        .ant-modal-title {
          color: #06b6d4 !important;
        }

        .dark-modal .ant-modal-close,
        .ant-modal-close {
          color: rgba(148, 163, 184, 0.8) !important;
        }

        .dark-modal .ant-modal-close:hover,
        .ant-modal-close:hover {
          color: #06b6d4 !important;
          background: rgba(6, 182, 212, 0.1) !important;
        }

        .dark-modal .ant-modal-footer,
        .ant-modal-footer {
          background: rgba(30, 41, 59, 0.9) !important;
          border-top: 1px solid #475569 !important;
          border-radius: 0 0 12px 12px !important;
          padding: 16px 24px !important;
          text-align: right !important;
        }

        .dark-modal .ant-modal-footer .ant-btn,
        .ant-modal-footer .ant-btn {
          margin-left: 8px !important;
          margin-right: 0 !important;
        }

        .dark-modal .ant-modal-body,
        .ant-modal-body {
          background: transparent !important;
          color: white !important;
        }

        /* 深色描述列表样式 - 更强的覆盖 */
        .dark-descriptions .ant-descriptions-item-label,
        .ant-descriptions-item-label {
          background: #374151 !important;
          color: #94a3b8 !important;
          font-weight: 500 !important;
          border-color: #475569 !important;
        }

        .dark-descriptions .ant-descriptions-item-content,
        .ant-descriptions-item-content {
          background: #1e293b !important;
          color: white !important;
          border-color: #475569 !important;
        }

        .dark-descriptions .ant-descriptions-view,
        .ant-descriptions-view {
          border-color: #475569 !important;
        }

        .dark-descriptions .ant-descriptions-row,
        .ant-descriptions-row {
          border-color: #475569 !important;
        }

        /* 深色表单样式 - 更强的覆盖 */
        .dark-form .ant-form-item-label > label,
        .ant-form-item-label > label {
          color: #94a3b8 !important;
        }

        .dark-form .ant-input,
        .ant-input {
          background: #374151 !important;
          border-color: #475569 !important;
          color: white !important;
        }

        .dark-form .ant-input:focus,
        .dark-form .ant-input:hover,
        .ant-input:focus,
        .ant-input:hover {
          border-color: #06b6d4 !important;
          box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2) !important;
        }

        .dark-form .ant-input:disabled,
        .ant-input:disabled {
          background: #1e293b !important;
          color: #06b6d4 !important;
        }

        .dark-form .ant-input::placeholder,
        .ant-input::placeholder {
          color: #64748b !important;
        }

        /* 按钮样式 */
        .ant-btn-primary {
          background: #06b6d4 !important;
          border-color: #06b6d4 !important;
        }

        .ant-btn-primary:hover {
          background: #0891b2 !important;
          border-color: #0891b2 !important;
        }

        .ant-btn-default {
          background: #374151 !important;
          border-color: #475569 !important;
          color: #94a3b8 !important;
        }

        .ant-btn-default:hover {
          background: #475569 !important;
          border-color: #64748b !important;
          color: #06b6d4 !important;
        }

        .ant-progress-bg {
          border-radius: 4px;
        }

        .ant-progress-inner {
          background: #374151 !important;
          border-radius: 4px;
        }

        .ant-tag {
          border-radius: 6px;
          font-weight: 500;
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
          width: 6px;
          height: 6px;
        }

        ::-webkit-scrollbar-track {
          background: #1e293b;
          border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
          background: #475569;
          border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
          background: #64748b;
        }
      `}</style>
      </div>
    </div>
  );
}
